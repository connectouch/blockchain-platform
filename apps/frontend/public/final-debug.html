<!DOCTYPE html>
<html>
<head>
    <title>Final Debug - Connectouch</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #0a0a0a; 
            color: #00ff00; 
            line-height: 1.6;
        }
        .success { background: #44ff44; color: black; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ff4444; color: white; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .info { background: #4444ff; color: white; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .warning { background: #ffaa00; color: black; padding: 10px; margin: 10px 0; border-radius: 5px; }
        pre { background: #333; padding: 10px; border-radius: 5px; overflow-x: auto; color: #00ff00; }
        .section { border: 1px solid #333; margin: 20px 0; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üîç Final Debug - What's Actually Missing?</h1>
    <div id="results"></div>
    <div id="root-test"></div>

    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        // Comprehensive error tracking
        const errors = [];
        const originalError = console.error;
        console.error = function(...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            errors.push(message);
            log(`‚ùå Console Error: ${message}`, 'error');
            originalError.apply(console, args);
        };

        // Track all errors
        window.addEventListener('error', function(e) {
            const errorMsg = `${e.message} at ${e.filename}:${e.lineno}:${e.colno}`;
            errors.push(errorMsg);
            log(`‚ùå JavaScript Error: ${errorMsg}`, 'error');
            if (e.error?.stack) {
                log(`Stack: ${e.error.stack}`, 'error');
            }
        });

        window.addEventListener('unhandledrejection', function(e) {
            const errorMsg = `Unhandled Promise: ${e.reason}`;
            errors.push(errorMsg);
            log(`‚ùå ${errorMsg}`, 'error');
        });

        log('üöÄ Final diagnostic started...', 'success');

        // Test 1: Backend connectivity
        async function testBackend() {
            log('<div class="section"><h3>üåê Backend Connectivity Test</h3></div>');
            
            const endpoints = [
                'https://aompecyfgnakkmldhidg.supabase.co/functions/v1/health-check',
                'https://aompecyfgnakkmldhidg.supabase.co/functions/v1/crypto-prices'
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    if (response.ok) {
                        log(`‚úÖ ${endpoint} - Working`, 'success');
                        log(`üìä Response: ${JSON.stringify(data).substring(0, 100)}...`, 'info');
                    } else {
                        log(`‚ùå ${endpoint} - Failed (${response.status})`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå ${endpoint} - Error: ${error.message}`, 'error');
                }
            }
        }

        // Test 2: Asset loading
        async function testAssets() {
            log('<div class="section"><h3>üì¶ Asset Loading Test</h3></div>');
            
            const assets = [
                '/assets/index-a7ojDpgy.js',
                '/assets/index-DoPNr-30.css',
                '/assets/vendor-Bs7gn1Hv.js',
                '/assets/ui-B9CAprHA.js'
            ];

            for (const asset of assets) {
                try {
                    const response = await fetch(asset);
                    if (response.ok) {
                        const content = await response.text();
                        log(`‚úÖ ${asset} - Loaded (${content.length} bytes)`, 'success');
                        
                        if (asset.includes('.js')) {
                            if (content.includes('React')) {
                                log(`‚úÖ Contains React code`, 'success');
                            }
                            if (content.includes('createRoot')) {
                                log(`‚úÖ Contains React 18 createRoot`, 'success');
                            }
                            if (content.includes('error') || content.includes('Error')) {
                                log(`‚ö†Ô∏è Contains error handling code`, 'warning');
                            }
                        }
                    } else {
                        log(`‚ùå ${asset} - Failed (${response.status})`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå ${asset} - Error: ${error.message}`, 'error');
                }
            }
        }

        // Test 3: Manual React test
        function testManualReact() {
            log('<div class="section"><h3>‚öõÔ∏è Manual React Test</h3></div>');
            
            const testRoot = document.getElementById('root-test');
            
            // Try to manually create React content
            try {
                testRoot.innerHTML = `
                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; text-align: center; margin: 20px 0;">
                        <h2>üéâ Manual DOM Test</h2>
                        <p>This content was manually inserted to test DOM manipulation</p>
                        <p>Time: ${new Date().toISOString()}</p>
                        <div style="margin-top: 15px;">
                            <button onclick="alert('Button works!')" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                Test Button
                            </button>
                        </div>
                    </div>
                `;
                log('‚úÖ Manual DOM manipulation successful', 'success');
            } catch (error) {
                log(`‚ùå Manual DOM manipulation failed: ${error.message}`, 'error');
            }
        }

        // Test 4: Environment check
        function testEnvironment() {
            log('<div class="section"><h3>üîß Environment Check</h3></div>');
            
            log(`User Agent: ${navigator.userAgent}`, 'info');
            log(`URL: ${window.location.href}`, 'info');
            log(`Protocol: ${window.location.protocol}`, 'info');
            log(`Host: ${window.location.host}`, 'info');
            
            // Check for required globals
            const globals = ['React', 'ReactDOM', 'process', 'module', 'require', 'fetch'];
            globals.forEach(global => {
                if (window[global]) {
                    log(`‚úÖ ${global} is available`, 'success');
                } else {
                    log(`‚ùå ${global} is not available`, 'warning');
                }
            });

            // Check localStorage
            try {
                localStorage.setItem('test', 'value');
                localStorage.removeItem('test');
                log('‚úÖ localStorage is working', 'success');
            } catch (error) {
                log(`‚ùå localStorage error: ${error.message}`, 'error');
            }
        }

        // Test 5: Load main script and monitor
        async function testMainScript() {
            log('<div class="section"><h3>üìú Main Script Loading Test</h3></div>');
            
            const script = document.createElement('script');
            script.type = 'module';
            script.src = '/assets/index-a7ojDpgy.js';
            
            return new Promise((resolve) => {
                script.onload = () => {
                    log('‚úÖ Main script loaded successfully', 'success');
                    
                    // Wait and check for React mounting
                    setTimeout(() => {
                        const root = document.getElementById('root');
                        if (root) {
                            if (root.children.length > 0) {
                                log('‚úÖ React has mounted content!', 'success');
                                log(`üìä Root content: ${root.innerHTML.substring(0, 200)}...`, 'info');
                            } else {
                                log('‚ùå React has not mounted any content', 'error');
                                log('üîç Checking for specific errors...', 'info');
                                
                                // Show all captured errors
                                if (errors.length > 0) {
                                    log(`üìã Captured ${errors.length} errors:`, 'warning');
                                    errors.forEach((error, index) => {
                                        log(`${index + 1}. ${error}`, 'error');
                                    });
                                } else {
                                    log('ü§î No errors captured - React might be loading silently', 'warning');
                                }
                            }
                        } else {
                            log('‚ùå Root element not found', 'error');
                        }
                        resolve();
                    }, 5000);
                };
                
                script.onerror = (error) => {
                    log(`‚ùå Failed to load main script: ${error}`, 'error');
                    resolve();
                };
                
                document.head.appendChild(script);
                log('üìú Script tag added to head', 'info');
            });
        }

        // Run all tests
        async function runAllTests() {
            try {
                await testBackend();
                await testAssets();
                testEnvironment();
                testManualReact();
                await testMainScript();
                
                log('<div class="section"><h3>üèÅ Final Summary</h3></div>', 'info');
                
                if (errors.length === 0) {
                    log('üéâ No errors detected! The platform should be working.', 'success');
                } else {
                    log(`‚ö†Ô∏è Found ${errors.length} issues that need to be fixed:`, 'warning');
                    errors.forEach((error, index) => {
                        log(`${index + 1}. ${error}`, 'error');
                    });
                }
                
            } catch (error) {
                log(`‚ùå Test suite failed: ${error.message}`, 'error');
            }
        }

        // Start tests
        setTimeout(runAllTests, 1000);
    </script>
</body>
</html>
